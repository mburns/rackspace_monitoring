# CHEF MANAGED FILE: DO NOT EDIT
# Controlling Cookbook: <%= @cookbook_name %>
#

type    : agent.load_average
label   : Load Average
disabled: <%= node['monitoring']['load']['disabled'] %>
period  : <%= node['monitoring']['load']['period'] %>
timeout : <%= node['monitoring']['load']['timeout'] %>
<% if node['monitoring']['load']['alarm'] == true %>
alarms  :
    alarm-load-average:
        label: High Load Average
        notification_plan_id: <%= node['monitoring']['notification_plan_id'] %>
        criteria: |
            if (metric['5m'] > <%= node['monitoring']['load']['crit'] %> ) {
              return new AlarmStatus(CRITICAL, '5 minute load average is #{5m}, above your critical threshold of <%= node['monitoring']['load']['crit'] %>');
            }
            if (metric['5m'] > <%= node['monitoring']['load']['warn'] %> ) {
              return new AlarmStatus(WARNING, '5 minute load average is #{5m}, above your warning threshold of <%= node['monitoring']['load']['warn']  %>');
            }
            return new AlarmStatus(OK, '5 minute load average is #{5m}, below your warning threshold of <%= node['monitoring']['load']['warn']  %>');
<% end %>
